<!DOCTYPE html>\n<html lang="es">\n<head>\n<meta charset="UTF-8">\n<title>Gestión de Inmuebles</title>\n<style>\n  body{font-family:Arial,sans-serif;margin:0;padding:20px;background:#f4f4f4;}\n  h1{color:#333;}\n  nav a{margin-right:15px;text-decoration:none;color:#0066cc;}\n  table{width:100%;border-collapse:collapse;margin-top:20px;}\n  th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left;}\n  th{background:#e2e2e2;}\n  button{margin-right:5px;padding:5px 10px;background:#0066cc;color:white;border:none;cursor:pointer;}\n  button:hover{background:#004999;}\n  form{margin-top:20px;background:#fff;padding:15px;border-radius:5px;}\n  label{display:block;margin-top:10px;}\n  input,select{width:100%;padding:8px;margin-top:5px;box-sizing:border-box;}\n  #modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}\n  #modalContent{background:#fff;padding:20px;border-radius:5px;width:300px;}\n</style>\n</head>\n<body>\n<nav><a href="index.html">Inmuebles</a><a href="propietarios.html">Propietarios</a></nav>\n<h1>Listado de Inmuebles</h1>\n<table id="inmuebleTable"><thead><tr><th>Dirección</th><th>Ciudad</th><th>Tipo</th><th>Precio</th><th>Disponible</th><th>Propietario</th><th>Acciones</th></tr></thead><tbody></tbody></table>\n<form id="addForm"><h2>Añadir Inmueble</h2><label>Dirección<input type="text" name="direccion" required></label><label>Ciudad<input type="text" name="ciudad" required></label><label>Tipo<select name="tipo" required><option value="Piso">Piso</option><option value="Casa">Casa</option><option value="Local">Local</option></select></label><label>Precio<input type="number" step="0.01" name="precio_alquiler"></label><label>Disponible<select name="disponible"><option value="true">Sí</option><option value="false">No</option></select></label><label>Propietario<select id="propSelect" name="propietario_id" required></select></label><button type="submit">Añadir</button></form>\n<div id="modal"><div id="modalContent"><h3>Editar Inmueble</h3><form id="editForm"><input type="hidden" name="id"><label>Dirección<input type="text" name="direccion" required></label><label>Ciudad<input type="text" name="ciudad" required></label><label>Tipo<select name="tipo" required><option value="Piso">Piso</option><option value="Casa">Casa</option><option value="Local">Local</option></select></label><label>Precio<input type="number" step="0.01" name="precio_alquiler"></label><label>Disponible<select name="disponible"><option value="true">Sí</option><option value="false">No</option></select></label><label>Propietario<select id="editPropSelect" name="propietario_id" required></select></label><button type="submit">Guardar</button><button type="button" onclick="closeModal()">Cancelar</button></form></div></div>\n<script>\nconst apiBase = '/api';\nasync function fetchJSON(url, opts={}){try{const res=await fetch(apiBase+url,opts);if(!res.ok){throw new Error(await res.text());}return await res.json();}catch(e){alert('Error: '+e.message);throw e;}}\nasync function loadPropietarios(select){const propietarios=await fetchJSON('/propietarios');select.innerHTML='';propietarios.forEach(p=>{const opt=document.createElement('option');opt.value=p.id;opt.textContent=p.nombre;select.appendChild(opt);});}\nasync function loadInmuebles(){const inmuebles=await fetchJSON('/inmuebles');const tbody=document.querySelector('#inmuebleTable tbody');tbody.innerHTML='';inmuebles.forEach(i=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${i.direccion}</td><td>${i.ciudad}</td><td>${i.tipo}</td><td>${i.precio_alquiler||'—'}</td><td>${i.disponible?'Sí':'No'}</td><td>${i.propietario?.nombre||'—'}</td><td><button onclick="editInmueble(${i.id})">Editar</button><button onclick="deleteInmueble(${i.id})">Eliminar</button></td>`;tbody.appendChild(tr);});}\nasync function addInmueble(e){e.preventDefault();const formData=new FormData(e.target);const data={...Object.fromEntries(formData)};data.propietario_id=parseInt(data.propietario_id);if(data.precio_alquiler) data.precio_alquiler=parseFloat(data.precio_alquiler);data.disponible=data.disponible==='true';await fetchJSON('/inmuebles',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});e.target.reset();loadInmuebles();}\nasync function deleteInmueble(id){if(!confirm('¿Eliminar inmueble?'))return;await fetchJSON(`/inmuebles/${id}`,{method:'DELETE'});loadInmuebles();}\nfunction openModal(){document.getElementById('modal').style.display='flex';}\nfunction closeModal(){document.getElementById('modal').style.display='none';document.getElementById('editForm').reset();}\nasync function editInmueble(id){const inmuebles=await fetchJSON('/inmuebles');const i=inmuebles.find(x=>x.id===id);if(!i)return;const form=document.getElementById('editForm');form.elements['id'].value=id;form.elements['direccion'].value=i.direccion;form.elements['ciudad'].value=i.ciudad;form.elements['tipo'].value=i.tipo;form.elements['precio_alquiler'].value=i.precio_alquiler||'';form.elements['disponible'].value=i.disponible?'true':'false';await loadPropietarios(document.getElementById('editPropSelect'));document.getElementById('editPropSelect').value=i.propietario_id;openModal();}\nasync function updateInmueble(e){e.preventDefault();const formData=new FormData(e.target);const data={...Object.fromEntries(formData)};data.id=parseInt(data.id);data.propietario_id=parseInt(data.propietario_id);if(data.precio_alquiler) data.precio_alquiler=parseFloat(data.precio_alquiler);data.disponible=data.disponible==='true';await fetchJSON(`/inmuebles/${data.id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});closeModal();loadInmuebles();}\ndocument.getElementById('addForm').addEventListener('submit',addInmueble);document.getElementById('editForm').addEventListener('submit',updateInmueble);window.addEventListener('DOMContentLoaded',()=>{loadPropietarios(document.getElementById('propSelect'));loadInmuebles();});\n</script>\n</body>\n</html>